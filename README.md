# Spec Gardener

[![GitHub Action](https://img.shields.io/badge/GitHub%20Action-black?logo=github-actions&logoColor=white)](https://github.com/ponharu/spec-gardener)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![Test](https://github.com/ponharu/spec-gardener/actions/workflows/test.yml/badge.svg)](https://github.com/ponharu/spec-gardener/actions/workflows/test.yml)

GitHub Action that transforms vague issues into detailed, code-ready specifications using AI CLI tools. It analyzes your codebase context and refines issue descriptions through conversation.

## Requirements

- One of the supported agent CLIs available on PATH (or installable via `bunx`)
- `GITHUB_TOKEN` with `issues: write` permission

## How It Works

1. When an issue is created (or `/spec-gardener` command is used), the action gathers the issue title, body, and comments.
2. It sends the context to the configured AI CLI agent.
3. The agent analyzes the codebase and either:
   - Asks clarifying questions via a comment
   - Updates the issue body with a refined specification
4. The original description is preserved in a collapsible section.
5. Use `/spec-gardener` in comments to continue the conversation and further refine the spec.

## Usage

Create `.github/workflows/spec-gardener.yml`:

```yaml
name: Spec Gardener
on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created]

jobs:
  spec-gardener:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    steps:
      - uses: actions/checkout@v6

      - name: Run Spec Gardener
        uses: ponharu/spec-gardener@main
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          agent: "codex"
          agent_timeout_ms: "120000"
```

## Commands

Use these commands in issue comments to interact with Spec Gardener:

| Command | Description |
| --- | --- |
| `/spec-gardener` | Analyze the issue and continue refining the specification |

## Configuration

| Input | Description | Required |
| --- | --- | --- |
| `github_token` | Token to comment and update issues. | Yes |
| `agent` | CLI command to execute (`codex`, `claude`, `gemini`). If the command is not on PATH, Spec Gardener runs it via `bunx` using mapped packages: `claude` â†’ `@anthropic-ai/claude-code`, `codex` â†’ `@openai/codex`, `gemini` â†’ `@google/gemini-cli`. | Yes |
| `agent_timeout_ms` | Timeout in milliseconds for the agent execution. | No (default: `120000`) |

## Behavior

With the example workflow above:

- **New issue created** - Automatically analyzed and refined
- **Issue edited** - Re-analyzed (skipped if already processed by Spec Gardener)
- **Comment with `/spec-gardener`** - Continues the conversation to refine the spec

The action prevents infinite loops by checking for its footer in the issue body and only responding to comments containing the `/spec-gardener` command.

## Output Format

### Issue Body

When Spec Gardener updates an issue, it preserves the original description:

```markdown
[Refined specification from the agent]

---
<details><summary>Original description</summary>

[Original issue description]

</details>

ðŸ¤– Generated by Spec Gardener
```

### Comments

Comments include available commands and mention the issue author:

```markdown
<details><summary>Commands</summary>

- `/spec-gardener` - Continue the conversation to refine this specification

</details>

@author [Agent's response or summary]

---
ðŸ¤– Generated by Spec Gardener
```

## Agents

Built-in adapters: `codex`, `claude`, `gemini`.

All agents receive the prompt via stdin and must return JSON.

### Provider Output Format

```json
{"type":"question","content":"..."}
```

or

```json
{"type":"complete","body":"...","comment":"optional completion comment"}
```

## Development

```bash
bun install
bun run lint
bun run typecheck
bun run test
```

## License

Apache-2.0

## Contributing

Contributions are welcome! Please open issues or pull requests for bugs, features, or improvements.
